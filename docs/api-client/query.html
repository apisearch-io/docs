<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Query</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Apisearch client - Query object">
    <meta name="author" content="Apisearch team">
    <meta name="keywords" content="Apisearch, Elasticsearch search engine, fast search demo, Apisearch official website">

    <!-- Favicons -->
    <link rel="apple-touch-icon" sizes="57x57" href="http://apisearch.io/public/images/favicons/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="http://apisearch.io/public/images/favicons/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="http://apisearch.io/public/images/favicons/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="http://apisearch.io/public/images/favicons/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="http://apisearch.io/public/images/favicons/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="http://apisearch.io/public/images/favicons/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="http://apisearch.io/public/images/favicons/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="http://apisearch.io/public/images/favicons/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="http://apisearch.io/public/images/favicons/apple-icon-180x180.png">
    <link rel="icon" type="image/png" sizes="192x192" href="http://apisearch.io/public/images/favicons/android-icon-192x192.png">
    <link rel="icon" type="image/png" sizes="32x32" href="http://apisearch.io/public/images/favicons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="http://apisearch.io/public/images/favicons/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16" href="http://apisearch.io/public/images/favicons/favicon-16x16.png">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="http://apisearch.io/public/images/favicons/ms-icon-144x144.png">
    <meta name="theme-color" content="#ffffff">

    <!-- Styles -->
    <link rel="stylesheet" href="./../assets/css/docs.css">
    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css"
          rel="stylesheet"
          integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN"
          crossorigin="anonymous"
    ></head>
<body>
    <!-- Header -->
    <header>
        <nav class="c-navbar navbar navbar-expand-md fixed-top">
            <div class="c-navbar__main row">
                <!-- Brand -->
                <div class="c-navbar__brandWrapper col-2 col-sm-4 col-md-3 col-lg-2">
                    <a class="c-navbar__brand navbar-brand" href="/docs">
                        <img src="http://apisearch.io/public/images/favicons/favicon-32x32.png"
                             class="d-inline-block align-top"
                             alt="Apisearch logo">
                        <img src="http://apisearch.io/public/images/logo-.png"
                             class="d-none d-sm-inline-block"
                             height="15"
                             alt="Logo Apisearch">
                    </a>
                </div>
                <!-- /Brand -->

                <!-- Search -->
                <div class="c-search col-8 col-sm-8 col-md-9 col-lg-10 ml-md-auto">
                    <i class="c-search__searchIcon fa fa-search"
                       aria-hidden="true"></i>

                    <!-- Apisearch target -->
                    <div class="c-search__wrapper" id="searchInput"></div>
                </div>
                <!-- /Search -->

                <!-- Menu burger -->
                <div class="col-2 d-sm-none">
                    <button class="c-navbar__burger navbar-toggler">
                        <svg xmlns="http://www.w3.org/2000/svg"
                             id="burgerSidebarMenu"
                             viewBox="0 0 30 30"
                             width="30"
                             height="30"
                             focusable="false"
                        >
                            <title>Menu</title>
                            <path stroke="#54edc0"
                                  stroke-width="2"
                                  stroke-linecap="round"
                                  stroke-miterlimit="10"
                                  d="M4 7h22M4 15h22M4 23h22"
                            ></path>
                        </svg>
                    </button>
                </div>
                <!-- /Menu burger -->
            </div>
        </nav>

        <!-- breadcrumb -->
        <nav class="c-breadcrumb" aria-label="breadcrumb" role="navigation">
            <ol class="c-breadcrumb__list breadcrumb">
                <li class="c-breadcrumb__item breadcrumb-item"><a href="#">Apisearch docs</a></li>
                    <li class="c-breadcrumb__item breadcrumb-item"><a href="#">API Client</a></li>
                <li class="c-breadcrumb__item--active breadcrumb-item active" aria-current="page">Query</li>
            </ol>
        </nav>
        <!-- /breadcrumb -->
    </header>    <!-- /Header -->

    <!-- Search result -->
    <div id="searchResult" class="c-search__result d-none">
        <!-- Overlay -->
        <div class="c-search__resultOverlay"></div>

        <!-- Result container -->
        <div class="container-fluid">
            <div class="row">
                <!-- Content -->
                <div class="col-sm-12">
                    <div class="c-search__resultBlock">
                        <div id="topicsSearchResult"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Pagination
        <div id="paginationSearch"></div>
        -->
    </div>    <!-- /Search result -->

    <!-- Main -->
    <div class="container-fluid">
        <div class="row">
            <!-- Sidebar -->
            <div id="sidebarMenu"
                 class="c-sidebar sidebar col-sm-4 col-md-3 col-lg-2 d-none d-sm-block"
            >
                <ul class="c-sidebar__nav nav nav-pills flex-column">
                                <li class="c-sidebar__navItem nav-item">
                                    <a class="c-sidebar__navLink c-sidebar__navLink--title nav-link"
                                       href="/docs/index.html"
                                    >
                                        <i class="fa fa-angle-right" aria-hidden="true"></i>
                                        Hello
                                    </a>
                                </li>
                                <li class="c-sidebar__navItem nav-item">
                                    <a class="c-sidebar__navLink c-sidebar__navLink--title nav-link"
                                       href="/docs/style-guide.html"
                                    >
                                        <i class="fa fa-angle-right" aria-hidden="true"></i>
                                        Style guide
                                    </a>
                                </li>
            
            
                            <li class="c-sidebar__navItem nav-item">
                                <a class="c-sidebar__navLink c-sidebar__navLink--title nav-link"
                                   href="#"
                                >
                                    <i class="fa fa-angle-right" aria-hidden="true"></i>
                                    UI
                                </a>
                            </li>
                            <ul class="c-sidebar__nav c-sidebar__nav--sub-1 nav nav-pills flex-column">
                                    <li class="c-sidebar__navItem--sub-1 nav-item">
                                        <a class="c-sidebar__navLink c-sidebar__navLink--subtitle nav-link"
                                           href="/docs/ui/overview.html">
                                            Overview
                                        </a>
                                    </li>
                                    <li class="c-sidebar__navItem--sub-1 nav-item">
                                        <a class="c-sidebar__navLink c-sidebar__navLink--subtitle nav-link"
                                           href="/docs/ui/widgets.html">
                                            Widgets
                                        </a>
                                    </li>
                            </ul>
            
                            <li class="c-sidebar__navItem nav-item">
                                <a class="c-sidebar__navLink c-sidebar__navLink--title nav-link"
                                   href="#"
                                >
                                    <i class="fa fa-angle-right" aria-hidden="true"></i>
                                    Integrations
                                </a>
                            </li>
                            <ul class="c-sidebar__nav c-sidebar__nav--sub-1 nav nav-pills flex-column">
                                    <li class="c-sidebar__navItem--sub-1 nav-item">
                                        <a class="c-sidebar__navLink c-sidebar__navLink--subtitle nav-link"
                                           href="/docs/integration/symfony-apisearch-bundle.html">
                                            Symfony - Apisearch Bundle
                                        </a>
                                    </li>
                            </ul>
            
                            <li class="c-sidebar__navItem nav-item">
                                <a class="c-sidebar__navLink c-sidebar__navLink--title nav-link"
                                   href="#"
                                >
                                    <i class="fa fa-angle-right" aria-hidden="true"></i>
                                    Fresh start
                                </a>
                            </li>
                            <ul class="c-sidebar__nav c-sidebar__nav--sub-1 nav nav-pills flex-column">
                                    <li class="c-sidebar__navItem--sub-1 nav-item">
                                        <a class="c-sidebar__navLink c-sidebar__navLink--subtitle nav-link"
                                           href="/docs/fresh-start/first-steps.html">
                                            First steps
                                        </a>
                                    </li>
                            </ul>
            
                            <li class="c-sidebar__navItem nav-item">
                                <a class="c-sidebar__navLink c-sidebar__navLink--title nav-link"
                                   href="#"
                                >
                                    <i class="fa fa-angle-right" aria-hidden="true"></i>
                                    API Client
                                </a>
                            </li>
                            <ul class="c-sidebar__nav c-sidebar__nav--sub-1 nav nav-pills flex-column">
                                    <li class="c-sidebar__navItem--sub-1 nav-item">
                                        <a class="c-sidebar__navLink c-sidebar__navLink--subtitle nav-link"
                                           href="/docs/api-client/index.html">
                                            Index
                                        </a>
                                    </li>
                                    <li class="c-sidebar__navItem--sub-1 nav-item">
                                        <a class="c-sidebar__navLink c-sidebar__navLink--subtitle nav-link"
                                           href="/docs/api-client/model.html">
                                            Model
                                        </a>
                                    </li>
                                    <li class="c-sidebar__navItem--sub-1 nav-item">
                                        <a class="c-sidebar__navLink c-sidebar__navLink--subtitle nav-link"
                                           href="/docs/api-client/query.html">
                                            Query
                                        </a>
                                    </li>
                                    <li class="c-sidebar__navItem--sub-1 nav-item">
                                        <a class="c-sidebar__navLink c-sidebar__navLink--subtitle nav-link"
                                           href="/docs/api-client/result.html">
                                            Result
                                        </a>
                                    </li>
                                    <li class="c-sidebar__navItem--sub-1 nav-item">
                                        <a class="c-sidebar__navLink c-sidebar__navLink--subtitle nav-link"
                                           href="/docs/api-client/repository.html">
                                            Repository
                                        </a>
                                    </li>
                                    <li class="c-sidebar__navItem--sub-1 nav-item">
                                        <a class="c-sidebar__navLink c-sidebar__navLink--subtitle nav-link"
                                           href="/docs/api-client/event.html">
                                            Event
                                        </a>
                                    </li>
                            </ul>
                </ul>
            </div>            <!-- Sidebar -->

            <!-- Main -->
            <main class="col-sm-8 col-md-8 ml-sm-auto mr-sm-auto pt-3" role="main">
                <section class="c-content">
                    <!-- Content -->
                    <h1>Query</h1>
<p>Knowing how our model is defined, let’s start by knowing how to make a simple
Query Request. Query objects will give us the possibility of communication
between our project and the server by just using some object methods, and by
using a single pattern called builder.</p>
<h2>Building a Query</h2>
<p>Let’s start with something really easy.</p>
<pre><code><span class="hljs-variable">$query</span> = <span class="hljs-symbol">Query:</span><span class="hljs-symbol">:create</span>(<span class="hljs-string">"something"</span>);
</code></pre>
<p>That simple. This small query will look for all entities in the repository,
Scoring each of the results containing the word “something” by hit scoring. The
best the first.</p>
<blockquote>
<p>Sorting by scoring means that, the best appearance the word “something” has
inside each result, the better punctuation has.</p>
</blockquote>
<p>Let’s make something a little bit harder. Let’s take only the first 100 elements
of the second page (from the result 101 to the 200). By default, is none of
these last values are defined, you will request the first 10 results.</p>
<pre><code class="language-php">$query = Query::create(
    <span class="hljs-string">"something"</span>, <span class="hljs-comment">// The query string</span>
    <span class="hljs-number">2</span>,           <span class="hljs-comment">// The page we want to retrieve</span>
    <span class="hljs-number">100</span>          <span class="hljs-comment">// How many items do we want?</span>
);
</code></pre>
<p>That’s it, that easy :)</p>
<p>If you want to match all elements, you can just pass an empty string as the
first parameter or use the search-everything static factory method. In this
second method you will query the first 1000 elements.</p>
<pre><code class="language-php">$query = Query::create(<span class="hljs-string">''</span>);
$query = Query::createMatchAll();
</code></pre>
<p>Finally, you can create a query to find one ore more specific elements from your
database. For this reason, there are two special static factory methods
specifically create to make these two scenarios so easy.</p>
<p>We will use <a href="#itemUUID">ItemUUIDs</a> here in both cases.</p>
<pre><code class="language-php">$query = Query::createByUUID(<span class="hljs-keyword">new</span> ItemUUID(<span class="hljs-string">'12'</span>, <span class="hljs-string">'book'</span>));
$query = Query::createByUUIDs([
    <span class="hljs-keyword">new</span> ItemUUID(<span class="hljs-string">'12'</span>, <span class="hljs-string">'book'</span>),
    <span class="hljs-keyword">new</span> ItemUUID(<span class="hljs-string">'123'</span>, <span class="hljs-string">'book'</span>),
    <span class="hljs-keyword">new</span> ItemUUID(<span class="hljs-string">'332'</span>, <span class="hljs-string">'book'</span>),
    <span class="hljs-keyword">new</span> ItemUUID(<span class="hljs-string">'555'</span>, <span class="hljs-string">'book'</span>),
    <span class="hljs-keyword">new</span> ItemUUID(<span class="hljs-string">'heavy'</span>, <span class="hljs-string">'book'</span>),
]);
</code></pre>
<p>The order is not important here, and the result format will be exactly the same
than any other type of queries.</p>
<h2>Filters</h2>
<p>Once a new Query is created you can start by filtering your results. This
library provides a developer friendly way for defining filters by exposing you a
nice set of public methods.</p>
<p>Before starting by using filters, let’s explain what an application type is and
the different values we have.</p>
<p>An <strong>application type</strong> is the way a filter is applied in your data set. For
example, if we want to filter our results by two categories, we want all the
results containing all the categories? We want all results containing at least
one of the defined categories? That’s the application type.</p>
<p>Let’s see all available types</p>
<ul>
<li><code>Filter::MUST_ALL</code> - All results must match all filter elements</li>
<li><code>Filter::MUST_ALL_WITH_LEVELS</code> - All results must match all filter elements, but
when aggregating, only facets with the minor level encountered will be shown.
E.g. categories.</li>
<li><code>Filter::AT_LEAST_ONE</code> - At least one element must match.</li>
<li><code>Filter::EXCLUDE</code> - Items should be excluded from results</li>
</ul>
<p>Every time we create a new filter, we must determine the type of this filter
application. Depending on that value, the filter will cause different values and
the resulting aggregation (facet) will change, even on your screen. Let’s take a
look at the different filters we can apply.</p>
<h2>Must all with levels</h2>
<p>An special explanation of this aggregation type.</p>
<p>Imagine your item is categorized with a tree-like structure.</p>
<ul>
<li>A - A1, A2</li>
<li>B - B1, B2, B3</li>
<li>C - C1</li>
</ul>
<p>You item could be related with a first-level category, and with one if its
subcategories. For example, your Item is categorized as A and A2 at the same
time.In that case you should relate your item with both, but adding an extra
field in your categories called <em>level</em>. The level of the category.</p>
<p>When you print these aggregations and you’ve defined this categorization as
MUST_ALL_WITH_LEVELS, you will print only these categories with the current
level. So, if you don’t have any filter applied, you should be able to filter
only by first level categories.</p>
<ul>
<li>[ ] Category A</li>
<li>[ ] Category B</li>
<li>[ ] Category C</li>
</ul>
<p>So what happens when we apply the A filter? Then, and because A has two children
A1 and A2, the aggregations will appear like that.</p>
<ul>
<li>[x] Category A</li>
<li>[ ] Category A1</li>
<li>[ ] Category A2</li>
</ul>
<h2>Filter types</h2>
<p>We will mainly talk about two different filter types, and it is very important
for you to understand both, why are they important and where to use each one.</p>
<p>First of all, we have something called Universe. We will call Universe to the
total set of Results. No matter the type, no matter the ID. Each Item accessible
by our API is part of our Universe.</p>
<p>In our website, or in our app, inside each landing page or screen we will want
to work with the entire Universe or with a subset of it, so this first step will
require us to use the filterUniverse methods.</p>
<pre><code class="language-php">$query = Query::createMatchAll()
    -&gt;filterUniverseByTypes([<span class="hljs-string">'A'</span>, <span class="hljs-string">'B'</span>]);
</code></pre>
<p>Once our Universe is properly defined, then we have to let the user navigate
through this universe by using the standard filters.</p>
<pre><code class="language-php">$query = Query::createMatchAll()
    -&gt;filterUniverseByTypes([<span class="hljs-string">'A'</span>, <span class="hljs-string">'B'</span>])
    -&gt;filterBy(<span class="hljs-string">'brand'</span>, <span class="hljs-string">'brand'</span>, [<span class="hljs-string">'Superbrand'</span>]);
</code></pre>
<p>Each filter strategy is documented for both universe and regular filters. As you
will see both methods will always change a little bit (regular filters will
always have a name as first parameter in order to relate later with a possible
aggregation).</p>
<h2>Filtering by Type</h2>
<p>So, try to imagine an environment when, even you have types A, B and C, you only
want to work with A and B. In this environment C is not welcomed, and you don’t
want C Items to be in any set of results.</p>
<p>Then, all queries inside this environment will need to filter the entire
universe by types A and B. Let’s see how to do it.</p>
<pre><code class="language-php">$query = Query::createMatchAll()
    -&gt;filterUniverseByTypes([<span class="hljs-string">'A'</span>, <span class="hljs-string">'B'</span>]);
</code></pre>
<p>All possible results will only include A and B. Think about this filter as a
permanent filter executed before all others.</p>
<p>Then you can use regular Filtering by type by using this method</p>
<pre><code class="language-php">$query = Query::createMatchAll()
    -&gt;filterUniverseByTypes([<span class="hljs-string">'A'</span>, <span class="hljs-string">'B'</span>])
    -&gt;filterByTypes([<span class="hljs-string">'A'</span>]);
</code></pre>
<p>But alert ! This seems to be exactly the same, right? Well, in this case we are
filtering by Types A and B, and then by type A, so results would only include A
types. That would be completely equivalent to filter the entire universe once by
type A.</p>
<p>Well, indeed. This would only work if your application has not aggregations nor
any kind of interaction with your user, where can filter manually by clicking
some kind of links.</p>
<p>Once Universe is filtered, and if you aggregate your values (in this case,
types), Results will contain only types A, but aggregations will still contain
all of them that are actually existing in the filtered Universe, so in this case
user would see something like this.</p>
<pre><code>[x]<span class="hljs-built_in"> Type </span>A
[ ]<span class="hljs-built_in"> Type </span>B
</code></pre>
<p>We could even have something like that</p>
<pre><code class="language-php">$query = Query::createMatchAll()
    -&gt;filterUniverseByTypes([<span class="hljs-string">'A'</span>, <span class="hljs-string">'B'</span>])
    -&gt;filterByTypes([<span class="hljs-string">'A'</span>, <span class="hljs-string">'B'</span>]);
</code></pre>
<p>With a result like that</p>
<pre><code>[x]<span class="hljs-built_in"> Type </span>A
[x]<span class="hljs-built_in"> Type </span>B
</code></pre>
<p>While if we have this implementation, ignoring our Universe filter, considering
that our filter is already working properly</p>
<pre><code class="language-php">$query = Query::createMatchAll()
    -&gt;filterByTypes([<span class="hljs-string">'A'</span>, <span class="hljs-string">'B'</span>]);
</code></pre>
<p>Then, our result would be something like that, so our Universe is not filtered
anymore and is composed by the total set of Items, including the C types.</p>
<pre><code class="language-php">[x] Type A
[x] Type B
[ ] Type C
</code></pre>
<p>On the other hand, if we only want the set of results matching your filter types
without the aggregations, we can also set a second boolean parameter to disable
aggregations (by default is set to <code>true</code>).</p>
<pre><code class="language-php">$query = Query::createMatchAll()
    -&gt;filterByTypes(
        [<span class="hljs-string">'A'</span>, <span class="hljs-string">'B'</span>]
        <span class="hljs-keyword">false</span>
    );
</code></pre>
<p>A third and last parameter can be set to sort the aggregations result. By default,
this parameter is set to <em>SORT_BY_COUNT_DESC</em>.</p>
<pre><code class="language-php">$query = Query::createMatchAll()
    -&gt;filterByTypes(
        [<span class="hljs-string">'A'</span>, <span class="hljs-string">'B'</span>]
        <span class="hljs-keyword">true</span>,
        Aggregation::SORT_BY_COUNT_ASC
    );
</code></pre>
<h2>Filtering By Id</h2>
<p>You can filter universe as well by ids. In that case, you can image that, no
matter what or how filters you add. Your result set will be of maximum 3 items.</p>
<pre><code class="language-php">$query = Query::createMatchAll()
    -&gt;filterUniverseByIds([<span class="hljs-string">'10'</span>, <span class="hljs-string">'11'</span>, <span class="hljs-string">'12'</span>]);
</code></pre>
<p>This is only useful if you work with a limited set of Items known by Ids.</p>
<p>Of course, filtering by ID is available as well inside your defined universe.
This is useful, for example, if you ID is a human readable value, and you want
to select a set of items from a list.</p>
<pre><code class="language-php">$query = Query::createMatchAll()
    -&gt;filterByIds([<span class="hljs-string">'10'</span>, <span class="hljs-string">'11'</span>, <span class="hljs-string">'12'</span>]);
</code></pre>
<h2>Filter by location</h2>
<p>You can filter your universe as well by Location if your Items are Geolocated.
This will allow you to work only with some Items positioned in a certain area.
You can use any of <a href="#location-ranges">Location Ranges</a> explained previously.</p>
<pre><code class="language-php">$query = Query::createMatchAll()
    -&gt;filterUniverseByLocation(<span class="hljs-keyword">new</span> CoordinateAndDistance(
        <span class="hljs-keyword">new</span> Coordinate(<span class="hljs-number">40.9</span>, <span class="hljs-number">-70.0</span>),
        <span class="hljs-string">'50km'</span>
    ))
</code></pre>
<p>Location is something that you should filter by just once. And because you can’t
aggregate by locations, it has’nt make sense at all to have both filters,
universe and regular, so they both mean exactly the same.</p>
<h2>Filter by range</h2>
<p>You can filter your universe as well by range. Depending if the filter uses a
date range or not, you should use one of these methods. Let’s imagine a landing
page where to list all T-shirts with low price (up to 20 euros). We want to add
only elements created during last month</p>
<pre><code class="language-php">$from = <span class="hljs-comment">// Date Atom of start of the month</span>
$to = <span class="hljs-comment">// Date Atom of the end of the month</span>
$query = Query::createMatchAll()
    -&gt;filterUniverseByRange(<span class="hljs-string">'price'</span>, [<span class="hljs-string">'0..20'</span>], Filter::MUST_ALL)
    -&gt;filterUniverseByDateRange(<span class="hljs-string">'created_at'</span>, [<span class="hljs-string">"$from..$to"</span>], Filter::MUST_ALL);
</code></pre>
<p>Furthermore, once defined your subset of available values, you can use the range
filter the same way as others.</p>
<p>This filter is considerably useful when filtering by price, by rating or by any
other numeric value (discount percentage…). Let’s work with the example of
price.</p>
<p>Let’s consider that we want all items with a price value from 50 to 60, and
from 90 to 100 euros. Let’s consider as well that this price value is part of
the indexed metadata. Let’s build the filter.</p>
<pre><code class="language-php">Query::createMatchAll()
    -&gt;filterByRange(
        <span class="hljs-string">'price'</span>,
        <span class="hljs-string">'price'</span>,
        [],
        [<span class="hljs-string">'50..60'</span>, <span class="hljs-string">'90..100'</span>]
    );
</code></pre>
<p>Let’s analyze what we created here. First of all, the name of the filter.
Because this is an open filter, we must define the filter field by hand. In our
case the range will be applied over the <code>price</code> field, but could be applied
over the <code>real_price</code> field, after some discount appliance, or the
<code>price_discount</code> as well.</p>
<p>This will allow you to define several range filters over the same field.</p>
<p>The third option is for faceting, we will check it later.
The fourth option is the important one. Is an array of ranges, and each range is
defined that way, separated by the string <code>..</code>.</p>
<p>By default, a range is defined as Filter::AT_LEAST_ONE, so in that case, each
option adds results to the final set. We can change the behavior by changing the
fifth parameter, and we can disable the auto-generated aggregation by changing
the sixth one.</p>
<pre><code class="language-php">Query::createMatchAll()
    -&gt;filterByRange(
        <span class="hljs-string">'price'</span>,
        <span class="hljs-string">'real_price'</span>,
        [],
        [<span class="hljs-string">'50..60'</span>, <span class="hljs-string">'90..100'</span>],
        FILTER::MUST_ALL,
        <span class="hljs-keyword">false</span>
    );
</code></pre>
<p>As you can see, this last example would return an empty set of elements as we
don’t have any item with a price lower than 60 euros and, at the same time,
higher than 90. Basics of logic of sets.</p>
<h2>Filter by field</h2>
<p>Finally, and of course, you can filter your universe by any value inserted in
your indexed_metadata array. Let’s take our first example, and let’s create a
landing page for only products from brand <em>Supershirts</em>. Other brands will not
be a possibility.</p>
<pre><code class="language-php">$query = Query::createMatchAll()
    -&gt;filterUniverseBy(<span class="hljs-string">'brand'</span>, [<span class="hljs-string">'Supershirts'</span>], Filter::MUST_ALL);
</code></pre>
<p>You can filter by any field as well after universe filtering. This method have
a first parameter called filter name. This should be unique, so two filters with
same name will just be overridden. You can make two or more filters with
different name over the same field. This filter name will be used as well later
when matching with existing aggregations.</p>
<pre><code class="language-php">Query::createMatchAll()
    -&gt;filterBy(
        <span class="hljs-string">'filtername'</span>,
        <span class="hljs-string">'field1'</span>,
        [<span class="hljs-string">'value1'</span>, <span class="hljs-string">'value2'</span>]
    );
</code></pre>
<p>By default, this filter is defined as <em>AT_LEAST_ONE</em> but you can change this
behavior by adding a fourth method parameter.</p>
<pre><code class="language-php">Query::createMatchAll()
    -&gt;filterByMeta(
        <span class="hljs-string">'filtername'</span>,
        <span class="hljs-string">'field1'</span>,
        [<span class="hljs-string">'value1'</span>, <span class="hljs-string">'value2'</span>],
        Filter::MUST_ALL
    );
</code></pre>
<blockquote>
<p>This filter works with the indexed_metadata field. Remember that the metadata
field stores non-indexable data</p>
</blockquote>
<p>By default, when you filter by meta, specific metadata field aggregation will be
enabled. Disable this aggregation by adding a fifth and last parameter, or just
override it later with a more specific aggregation configuration.</p>
<pre><code class="language-php">Query::createMatchAll()
    -&gt;filterBy(
        <span class="hljs-string">'filtername'</span>,
        <span class="hljs-string">'field1'</span>,
        [<span class="hljs-string">'value1'</span>, <span class="hljs-string">'value2'</span>],
        Filter::AT_LEAST_ONE,
        <span class="hljs-keyword">false</span>
    );
</code></pre>
<h2>Aggregations {#query-aggregations}</h2>
<p>Once we have applied our filters, part of the result set is what we call
aggregations. This concept is usually understood as well as facets and is the
part of your application where filters are dynamically generated by using the
total number of results in the data set.</p>
<p>For example, if we can filter by the item’s manufacturer 'Nike’, but with the
current set of filters, there is not elements manufactured by Nike available,
Nike should’nt be available. Otherwise, if it is, then we should have the
capability of showing the final user the real number of Nike elements available.</p>
<p>This is what we call aggregations.</p>
<p>Each filter applied creates, unless you say otherwise, an aggregation group with
all available options for this filter. If you filter by the item Nike,
your result will come with a group called <em>manufacturers</em> and with all
other manufacturers available to be filtered, each one with the elements total
in your database.</p>
<p>You can create aggregations by hand, for example, if you don’t really want
filters, or if the aggregation itself requires an special configuration.</p>
<pre><code class="language-php">Query::createMatchAll()
    -&gt;aggregateBy(
        <span class="hljs-string">'fieldname'</span>
        <span class="hljs-string">'field1'</span>
    );
</code></pre>
<p>Previous filters with name <code>fieldname</code> will be searched in order to create the
Result object.
You can change the order of the aggregation, so you don’t have to do it later in
your process.</p>
<pre><code class="language-php">Query::createMatchAll()
    -&gt;aggregateBy(
        <span class="hljs-string">'fieldname'</span>
        <span class="hljs-string">'field1'</span>,
        Filter::AT_LEAST_ONE,
        Aggregation::SORT_BY_COUNT_DESC
    );
</code></pre>
<p>You can chose between these values</p>
<ul>
<li><code>Aggregation::SORT_BY_COUNT_DESC</code></li>
<li><code>Aggregation::SORT_BY_COUNT_ASC</code></li>
<li><code>Aggregation::SORT_BY_NAME_DESC</code></li>
<li><code>Aggregation::SORT_BY_NAME_ASC</code></li>
</ul>
<p>You can limit as well the number of elements you want to return in the
aggregation. By default, there’s no limit, so if your result aggregation has
10000 possible values, an array of 10000 counters will be returned. This is
usually not good for performance.</p>
<pre><code class="language-php">Query::createMatchAll()
    -&gt;aggregateBy(
        <span class="hljs-string">'fieldname'</span>
        <span class="hljs-string">'field1'</span>,
        Filter::AT_LEAST_ONE,
        Aggregation::SORT_BY_COUNT_DESC,
        Aggregation::NO_LIMIT
    );
</code></pre>
<p>Aggregations can be enabled or disabled by using these flag methods. This flag
will override all behaviors from all filter methods (remember that when
filtering by some fields, for example Types, you can enable or disable a
specific aggregation). If aggregations are enabled, then the behavior will not
change and each field specific behaviors will be used. If disable, all field
specific behaviors will be disabled.</p>
<pre><code class="language-php">Query::create(<span class="hljs-string">''</span>)
    -&gt;disableAggregations()
;
</code></pre>
<p>In this case, aggregations are specifically enabled by Types setting the second
parameter to <code>true</code>, but disabled by flag, so no aggregations will be requested.</p>
<pre><code class="language-php">Query::createMatchAll()
    -&gt;filterByTypes(
        [<span class="hljs-string">'product'</span>],
        <span class="hljs-keyword">true</span>
    )
    -&gt;disabledAggregations()
;
</code></pre>
<h2>Sort by field</h2>
<p>You can sort your results, of course. The Query object provides one method for
this, and the SortBy object defines a prebuilt set of sorting types ready to be
used by you. You can define the sorting field and the type by yourself.</p>
<pre><code class="language-php">Query::createMatchAll()
    -&gt;sortBy(
        [<span class="hljs-string">'indexed_metadata.manufacturer'</span>, <span class="hljs-string">'asc'</span>]
    );

Query::createMatchAll()
    -&gt;sortBy(
        [<span class="hljs-string">'indexed_metadata.name'</span>, <span class="hljs-string">'desc'</span>]
    );

Query::createMatchAll()
    -&gt;sortBy(
        [<span class="hljs-string">'indexed_metadata.updated_at'</span>, <span class="hljs-string">'desc'</span>]
    );
</code></pre>
<p>We can use prebuilt sorts. The first one is the one applied by default when no
sorting is defined. The better score given a query, the earlier in results.
This is the list of all of them.</p>
<pre><code class="language-php">Query::createMatchAll()
    -&gt;sortBy(SortBy::SCORE)
    -&gt;sortBy(SortBy::ID_ASC)
    -&gt;sortBy(SortBy::ID_DESC)
    -&gt;sortBy(SortBy::TYPE_ASC)
    -&gt;sortBy(SortBy::TYPE_DESC)
;
</code></pre>
<p>When you define a sort element, you override the existing one.</p>
<h2>Sort by location</h2>
<p>A set of special sorting types can sort as well by location. In order to make
this sorting work, we must create our Query instance by using the method
<code>createLocated()</code> instead of <code>create()</code>. The only difference between both is
that the first one’s first parameter is a <code>Coordinate</code> instance. Therefore,
the second parameter is the query text.</p>
<pre><code class="language-php">$query = Query::createLocated(
    <span class="hljs-keyword">new</span> Coordinate(<span class="hljs-number">40.0</span>, <span class="hljs-number">-70.0</span>),
    <span class="hljs-string">''</span>
);
</code></pre>
<p>Because the only way that could make sense when sorting by location is
requesting first of all the elements closer to us, we can only sort them by
location in an <em>asc</em> mode.</p>
<pre><code class="language-php">$query = Query::createLocated(
        <span class="hljs-keyword">new</span> Coordinate(<span class="hljs-number">40.0</span>, <span class="hljs-number">-70.0</span>), 
        <span class="hljs-string">''</span>
    )
    -&gt;sortBy(SortBy::LOCATION_KM_ASC)
    -&gt;sortBy(SortBy::LOCATION_MI_ASC)
;
</code></pre>
<p>Both sorting types return exactly the same results in the same order, but both
return the distance of each hit in different units. The first of all in
kilometers and the second one in miles.</p>
<p>Using this sort type, we will be able to know the distance of each of the
Product instances received by using the special Product method <code>-&gt;getDistance()</code>
defined and filled only in this scenario. The result of this method is a float
value.</p>
<pre><code class="language-php">$item-&gt;getDistance();
</code></pre>
<h2>Sort randomly</h2>
<p>You can sort your elements in a random way by using the fast predefined value</p>
<pre><code class="language-php">Query::createMatchAll()
    -&gt;sortBy(SortBy::RANDOM)
;
</code></pre>
<h2>Enabling suggestions</h2>
<p>Suggestions can be enabled or disabled by using these flag methods.</p>
<pre><code class="language-php">Query::create(<span class="hljs-string">''</span>)
    -&gt;disableAggregations()
;

Query::create(<span class="hljs-string">''</span>)
    -&gt;enableAggregations()
;
</code></pre>
<p>Please, read <a href="#reading-suggestions">Reading Suggestions</a> to know a little bit
more about suggestions.</p>
<h2>Excluding some elements</h2>
<p>Having some kind of black list would be useful as well. For example, when
printing a related carousel given an item, and filtering by the type,
would be useful to exclude the current element from the list.</p>
<p>In order to do this, we will use UUIDs, so we can filter by any kind of
element only having the UUID.</p>
<pre><code class="language-php">Query::createMatchAll()
    -&gt;filterByTypes(
        [<span class="hljs-string">'product'</span>]
    )
    -&gt;excludeUUID(<span class="hljs-keyword">new</span> ItemUUID(<span class="hljs-string">'10'</span>, <span class="hljs-string">'product'</span>))
;
</code></pre>
<p>In this example we are excluding the Item with ID 10 and ‘product’ as type.
Remember that an item is always referenced not only by the id but with a
composition between the ID and the type.</p>
<p>We can filter by several UUIDs as well.</p>
<pre><code class="language-php">Query::createMatchAll()
    -&gt;filterByTypes(
        [<span class="hljs-string">'product'</span>]
    )
    -&gt;excludeUUIDs([
        <span class="hljs-keyword">new</span> ItemUUID(<span class="hljs-string">'10'</span>, <span class="hljs-string">'product'</span>),
        <span class="hljs-keyword">new</span> ItemUUID(<span class="hljs-string">'5'</span>, <span class="hljs-string">'product'</span>),
        <span class="hljs-keyword">new</span> ItemUUID(<span class="hljs-string">'100'</span>, <span class="hljs-string">'product'</span>),
        <span class="hljs-keyword">new</span> ItemUUID(<span class="hljs-string">'21'</span>, <span class="hljs-string">'product'</span>),
    ])
;
</code></pre>

                    <!-- /Content -->

                    <hr>
                    <a class="c-content__editOnGithub"
                       target="_blank"
                       href="https://github.com/apisearch-io/docs/tree/master/src/content/api-client/query.md">
                        <i class="fa fa-github" aria-hidden="true"></i>
                        Edit this page!
                    </a>
                </section>
            </main>
            <!-- /Main -->

            <!-- Toc here -->
            <div class="c-toc col-lg-2 d-none d-lg-block">
                <ul class="c-toc__nav nav nav-pills flex-column">
                    <li class="c-toc__navItem c-toc__navItem--1 nav-item">
                        <a class="c-toc__navLink c-toc__navLink--title nav-link"
                           href="#query"
                        >
                            Query
                        </a>
                    </li>
                    <li class="c-toc__navItem c-toc__navItem--2 nav-item">
                        <a class="c-toc__navLink c-toc__navLink--title nav-link"
                           href="#building-a-query"
                        >
                            Building a Query
                        </a>
                    </li>
                    <li class="c-toc__navItem c-toc__navItem--2 nav-item">
                        <a class="c-toc__navLink c-toc__navLink--title nav-link"
                           href="#filters"
                        >
                            Filters
                        </a>
                    </li>
                    <li class="c-toc__navItem c-toc__navItem--2 nav-item">
                        <a class="c-toc__navLink c-toc__navLink--title nav-link"
                           href="#must-all-with-levels"
                        >
                            Must all with levels
                        </a>
                    </li>
                    <li class="c-toc__navItem c-toc__navItem--2 nav-item">
                        <a class="c-toc__navLink c-toc__navLink--title nav-link"
                           href="#filter-types"
                        >
                            Filter types
                        </a>
                    </li>
                    <li class="c-toc__navItem c-toc__navItem--2 nav-item">
                        <a class="c-toc__navLink c-toc__navLink--title nav-link"
                           href="#filtering-by-type"
                        >
                            Filtering by Type
                        </a>
                    </li>
                    <li class="c-toc__navItem c-toc__navItem--2 nav-item">
                        <a class="c-toc__navLink c-toc__navLink--title nav-link"
                           href="#filtering-by-id"
                        >
                            Filtering By Id
                        </a>
                    </li>
                    <li class="c-toc__navItem c-toc__navItem--2 nav-item">
                        <a class="c-toc__navLink c-toc__navLink--title nav-link"
                           href="#filter-by-location"
                        >
                            Filter by location
                        </a>
                    </li>
                    <li class="c-toc__navItem c-toc__navItem--2 nav-item">
                        <a class="c-toc__navLink c-toc__navLink--title nav-link"
                           href="#filter-by-range"
                        >
                            Filter by range
                        </a>
                    </li>
                    <li class="c-toc__navItem c-toc__navItem--2 nav-item">
                        <a class="c-toc__navLink c-toc__navLink--title nav-link"
                           href="#filter-by-field"
                        >
                            Filter by field
                        </a>
                    </li>
                    <li class="c-toc__navItem c-toc__navItem--2 nav-item">
                        <a class="c-toc__navLink c-toc__navLink--title nav-link"
                           href="#aggregations-#query-aggregations"
                        >
                            Aggregations {#query-aggregations}
                        </a>
                    </li>
                    <li class="c-toc__navItem c-toc__navItem--2 nav-item">
                        <a class="c-toc__navLink c-toc__navLink--title nav-link"
                           href="#sort-by-field"
                        >
                            Sort by field
                        </a>
                    </li>
                    <li class="c-toc__navItem c-toc__navItem--2 nav-item">
                        <a class="c-toc__navLink c-toc__navLink--title nav-link"
                           href="#sort-by-location"
                        >
                            Sort by location
                        </a>
                    </li>
                    <li class="c-toc__navItem c-toc__navItem--2 nav-item">
                        <a class="c-toc__navLink c-toc__navLink--title nav-link"
                           href="#sort-randomly"
                        >
                            Sort randomly
                        </a>
                    </li>
                    <li class="c-toc__navItem c-toc__navItem--2 nav-item">
                        <a class="c-toc__navLink c-toc__navLink--title nav-link"
                           href="#enabling-suggestions"
                        >
                            Enabling suggestions
                        </a>
                    </li>
                    <li class="c-toc__navItem c-toc__navItem--2 nav-item">
                        <a class="c-toc__navLink c-toc__navLink--title nav-link"
                           href="#excluding-some-elements"
                        >
                            Excluding some elements
                        </a>
                    </li>
                </ul>
            </div>
            <!-- End toc -->

            <!-- Footer -->
            <footer class="c-footer col-sm-9 ml-sm-auto col-md-10 pt-3">
                <nav class="navbar">
                    <span class="c-footer__logoWrapper navbar-text text-center d-block">
                        <img src="http://apisearch.io/public/images/favicons/favicon-32x32.png"
                             class="c-footer__logo c-footer__logo--top d-block align-top"
                             alt="Apisearch logo"
                        >
                        <img src="http://apisearch.io/public/images/logo-.png"
                             height="16"
                             class="c-footer__logo c-footer__logo--bottom d-block align-top"
                             alt="Logo Apisearch"
                        >
                    </span>
                    <ul class="c-footer__linksWrapper navbar-nav">
                        <li class="c-footer__linkItem nav-item">
                            <a href="https://github.io/apisearch-io/"
                               target="_blank"
                               class="c-footer__link c-footer__link--icon nav-link"
                            >
                                <i class="fa fa-github" aria-hidden="true"></i>
                            </a>
                        </li>
                        <li class="c-footer__linkItem nav-item">
                            <a href="https://twitter.com/apisearch_io"
                               target="_blank"
                               class="c-footer__link c-footer__link--icon nav-link"
                            >
                                <i class="fa fa-twitter" aria-hidden="true"></i>
                            </a>
                        </li>
                        <li class="c-footer__linkItem nav-item">
                            <a href="#linkedin"
                               target="_blank"
                               class="c-footer__link c-footer__link--icon nav-link"
                            >
                                <i class="fa fa-linkedin" aria-hidden="true"></i>
                            </a>
                        </li>
                    </ul>
                    <ul class="c-footer__linksWrapper navbar-nav">
                        <li class="c-footer__linkItem nav-item">
                            <a href="http://apisearch.io"
                               class="c-footer__link nav-link"
                            >
                                Home
                            </a>
                        </li>
                        <li class="c-footer__linkItem nav-item">
                            <a href="http://apisearch-io.github.com/docs/"
                               class="c-footer__link nav-link"
                            >
                                Docs
                            </a>
                        </li>
                        <li class="c-footer__linkItem nav-item">
                            <a href="#examples"
                               class="c-footer__link nav-link"
                            >
                                Examples
                            </a>
                        </li>
                        <li class="c-footer__linkItem nav-item">
                            <a href="mailto:hello@puntmig.com"
                               class="c-footer__link nav-link"
                            >
                                Contact
                            </a>
                        </li>
                        <li class="c-footer__linkItem nav-item">
                            <a href="#terms-and-conditions"
                               class="c-footer__link nav-link"
                            >
                                Terms & Conditions
                            </a>
                        </li>
                    </ul>
                </nav>
            </footer>            <!-- /Footer -->
        </div>
    </div>
    <!-- /Main -->

    <!-- Go up -->
    <a id="goUpButton"
       class="c-goUp d-none fa fa-angle-up"
       href="#"
       aria-hidden="true"
    ></a>
    <!-- /Go up -->

    <!-- Scripts -->
    <script src="./../assets/js/app.js"></script>
</body>
</html>